<!DOCTYPE html>
<html>
<head>
    <title>{{ title }}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<nav class="navbar navbar-dark bg-dark px-4">
    <span class="navbar-brand">Smart Food Pre-Ordering System</span>

    <div>
        <span class="text-white me-3">
            Welcome, {{ current_user.name }}
        </span>
        <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm">
            Logout
        </a>
    </div>
</nav>

<div class="container mt-5">

    {% if current_user.role == "student" %}

        <h2 class="text-center mb-4">Student Dashboard</h2>

        <div class="text-center mb-4">
            <a href="{{ url_for('order_food') }}" class="btn btn-primary btn-lg me-3">Order Food</a>
            <a href="{{ url_for('my_orders') }}" class="btn btn-warning btn-lg">My Orders</a>
        </div>

        {% if peak_slot_time %}
        <div class="alert alert-warning text-center">
            ðŸ”¥ Peak Order Time: <strong>{{ peak_slot_time }}</strong>
        </div>
        {% endif %}

        <div class="row text-center mb-4">
            <div class="col-md-6">
                <div class="card shadow p-3">
                    <h5>Total Orders</h5>
                    <h3>{{ total_orders }}</h3>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card shadow p-3">
                    <h5>Total Spent</h5>
                    <h3>â‚¹ {{ total_spent }}</h3>
                </div>
            </div>
        </div>

        <div class="card shadow p-4">
            <h5 class="text-center mb-3">Orders Over Time</h5>
            <canvas id="ordersChart"></canvas>
        </div>

        <script>
        const ctx = document.getElementById('ordersChart');
        const labels = [
            {% for day, count in orders_by_day %}
                "{{ day }}",
            {% endfor %}
        ];
        const data = {
            labels: labels,
            datasets: [{
                label: 'Orders Per Day',
                data: [
                    {% for day, count in orders_by_day %}
                        {{ count }},
                    {% endfor %}
                ],
                borderWidth: 2
            }]
        };
        new Chart(ctx, {
            type: 'bar',
            data: data,
        });
        </script>

    {% endif %}

</div>

</body>
</html>
